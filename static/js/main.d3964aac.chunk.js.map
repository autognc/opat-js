{"version":3,"sources":["sample_data/image_000.png","sample_data/image_240.png","sample_data/image_480.png","sample_data/cygnus.glb","config.js","controls.js","viewer.js","OpacityShader.js","topbar.js","sidebar.js","sample_data/load_sample_data.js","index.js"],"names":["module","exports","CONFIG","keybindings","KeyW","KeyS","KeyA","KeyD","KeyZ","KeyX","ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Slash","Period","ShiftLeft","Enter","opacity","translate_speed","translate_speed_low","rotate_speed","rotate_speed_low","default_pose","position","rotation","Controls","model","setPose","ACTIONS","Object","fromEntries","entries","map","key","value","bind","this","keyDownListener","handleKeyDown","keyUpListener","handleKeyUp","executingActions","Set","Math","PI","document","addEventListener","removeEventListener","event","code","preventDefault","repeat","undefined","_decreaseSpeed","add","_resetSpeed","_recordPose","delete","delta","action","save","quaternion","x","y","z","w","toArray","rotateOnAxis","Vector3","Renderer","fov","initialPose","console","log","pose","useThree","camera","gl","scene","controls","React","useMemo","useLayoutEffect","register","deregister","up","set","lookAt","updateProjectionMatrix","slice","setRotationFromQuaternion","Quaternion","composer","useRef","useFrame","state","update","current","render","object","ref","args","attachArray","uniforms","tDiffuse","vertexShader","join","fragmentShader","extend","ShaderPass","RenderPass","EffectComposer","memo","style","intensity","OpenFileButton","props","children","label","disabled","onChoose","others","type","display","onChange","target","files","className","Button","size","variant","onClick","click","TopBar","setCurrentImageIndex","images","setImages","setModel","setIntrinsics","currentPose","setPoses","poses","isPoseSaved","useState","intrinsicsName","setIntrinsicsName","modelName","setModelName","error","setError","loader","GLTFLoader","n","toFixed","length","multiple","accept","name","file","arrayBuffer","then","ab","parse","gltf","scenes","loadModel","text","resultText","intrinsics","JSON","keys","Array","from","every","i","has","values","fov_y","loadIntrinsics","p","isArray","concat","e","loadPoses","obj","a","createElement","Blob","stringify","href","URL","createObjectURL","download","revokeObjectURL","saveAs","currentImageIndex","ListGroup","image","Item","active","IMAGE_NAMES","computeViewerPosition","img","naturalHeight","naturalWidth","height","width","rescale","min","newHeight","newWidth","left","top","App","viewerPosition","setViewerPosition","setCurrentPose","setIsPoseSaved","useEffect","imagesPromise","Promise","all","image_000","image_240","image_480","window","fetch","res","blob","modelPromise","cygnus","resolve","loadSampleData","imgRef","imgUrlRef","imgUrl","useCallback","handleResize","assign","alt","src","onLoad","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.d3964aac.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/image_000.1d777ccf.png\";","module.exports = __webpack_public_path__ + \"static/media/image_240.097c432e.png\";","module.exports = __webpack_public_path__ + \"static/media/image_480.90688ae9.png\";","module.exports = __webpack_public_path__ + \"static/media/cygnus.7bb66b61.glb\";","const CONFIG = {\n  keybindings: {\n    KeyW: \"translateUp\",\n    KeyS: \"translateDown\",\n    KeyA: \"translateLeft\",\n    KeyD: \"translateRight\",\n    KeyZ: \"translateForward\",\n    KeyX: \"translateBackward\",\n    ArrowDown: \"rotateMinusZ\",\n    ArrowUp: \"rotatePlusZ\",\n    ArrowLeft: \"rotateMinusY\",\n    ArrowRight: \"rotatePlusY\",\n    Slash: \"rotateMinusX\",\n    Period: \"rotatePlusX\",\n    ShiftLeft: \"decreaseSpeed\",\n    Enter: \"savePose\",\n  },\n  opacity: 0.7,\n  // meters/second\n  translate_speed: 5,\n  translate_speed_low: 1,\n  // degrees/second\n  rotate_speed: 20,\n  rotate_speed_low: 5,\n  default_pose: {\n    position: [0, 0, 50],\n    rotation: [1, 0, 0, 0],\n  },\n};\n\nexport default CONFIG;\n","import { Vector3 } from \"three\";\nimport CONFIG from \"./config\";\n\nexport default class Controls {\n  ACTIONS = Object.fromEntries(\n    Object.entries(CONFIG.keybindings).map(([key, value]) => [\n      key,\n      this[value] ? this[value].bind(this) : value,\n    ])\n  );\n\n  constructor(model, setPose) {\n    this.model = model;\n    this.keyDownListener = this.handleKeyDown.bind(this);\n    this.keyUpListener = this.handleKeyUp.bind(this);\n    this.executingActions = new Set();\n    this.translate_speed = CONFIG.translate_speed;\n    this.rotate_speed = (CONFIG.rotate_speed * 2 * Math.PI) / 180;\n    this.setPose = setPose;\n  }\n\n  register() {\n    document.addEventListener(\"keydown\", this.keyDownListener);\n    document.addEventListener(\"keyup\", this.keyUpListener);\n  }\n\n  deregister() {\n    document.removeEventListener(\"keydown\", this.keyDownListener);\n    document.removeEventListener(\"keyup\", this.keyUpListener);\n  }\n\n  handleKeyDown(event) {\n    if (this.ACTIONS[event.code]) event.preventDefault();\n    if (event.repeat) return;\n    switch (this.ACTIONS[event.code]) {\n      case undefined:\n        break;\n      case \"decreaseSpeed\":\n        this._decreaseSpeed();\n        break;\n      case \"savePose\":\n        break;\n      default:\n        this.executingActions.add(this.ACTIONS[event.code]);\n    }\n  }\n\n  handleKeyUp(event) {\n    if (this.ACTIONS[event.code]) event.preventDefault();\n    switch (this.ACTIONS[event.code]) {\n      case undefined:\n        break;\n      case \"decreaseSpeed\":\n        this._resetSpeed();\n        break;\n      case \"savePose\":\n        this._recordPose(true);\n        break;\n      default:\n        this.executingActions.delete(this.ACTIONS[event.code]);\n        this._recordPose(false);\n    }\n  }\n\n  update(delta) {\n    for (const action of this.executingActions) {\n      action(delta);\n    }\n  }\n\n  _recordPose(save) {\n    const { x, y, z, w } = this.model.quaternion;\n    this.setPose(\n      {\n        position: this.model.position.toArray(),\n        rotation: [w, x, y, z],\n      },\n      save\n    );\n  }\n\n  _decreaseSpeed() {\n    this.translate_speed = CONFIG.translate_speed_low;\n    this.rotate_speed = (CONFIG.rotate_speed_low * 2 * Math.PI) / 180;\n  }\n  _resetSpeed() {\n    this.translate_speed = CONFIG.translate_speed;\n    this.rotate_speed = (CONFIG.rotate_speed * 2 * Math.PI) / 180;\n  }\n\n  translateUp(delta) {\n    this.model.position.y -= this.translate_speed * delta;\n  }\n  translateDown(delta) {\n    this.model.position.y += this.translate_speed * delta;\n  }\n  translateLeft(delta) {\n    this.model.position.x -= this.translate_speed * delta;\n  }\n  translateRight(delta) {\n    this.model.position.x += this.translate_speed * delta;\n  }\n  translateForward(delta) {\n    this.model.position.z += this.translate_speed * delta;\n  }\n  translateBackward(delta) {\n    this.model.position.z -= this.translate_speed * delta;\n  }\n  rotatePlusZ(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 0, 1), this.rotate_speed * delta);\n  }\n  rotateMinusZ(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 0, 1), -this.rotate_speed * delta);\n  }\n  rotatePlusY(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 1, 0), this.rotate_speed * delta);\n  }\n  rotateMinusY(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 1, 0), -this.rotate_speed * delta);\n  }\n  rotatePlusX(delta) {\n    this.model.rotateOnAxis(new Vector3(1, 0, 0), this.rotate_speed * delta);\n  }\n  rotateMinusX(delta) {\n    this.model.rotateOnAxis(new Vector3(1, 0, 0), -this.rotate_speed * delta);\n  }\n}\n","import React from \"react\";\nimport { extend } from \"react-three-fiber\";\nimport { Canvas, useFrame, useThree } from \"react-three-fiber\";\nimport { Quaternion, Vector3 } from \"three\";\nimport { ShaderPass } from \"three/examples/jsm/postprocessing/ShaderPass\";\nimport { RenderPass } from \"three/examples/jsm/postprocessing/RenderPass\";\nimport { EffectComposer } from \"three/examples/jsm/postprocessing/EffectComposer\";\nimport Controls from \"./controls\";\nimport CONFIG from \"./config\";\nimport OpacityShader from \"./OpacityShader\";\nextend({ ShaderPass, RenderPass, EffectComposer });\n\nfunction Renderer({ model, fov, setPose, initialPose }) {\n  console.log(\"renderer re-render\");\n  const { camera, gl, scene } = useThree();\n\n  const controls = React.useMemo(() => new Controls(model, setPose), [\n    model,\n    setPose,\n  ]);\n  // Need useLayoutEffect because we want the controls to deregister ASAP (before render) whenever\n  // the image changes. With regular useEffect, which happens after render, there is a brief window of time\n  // between when the model's pose gets updated for the new image and when the old controls get de-registered.\n  // Since the old controls have the old setPose, they can set the new image's pose on the old image during this window.\n  React.useLayoutEffect(() => {\n    controls.register();\n    return () => controls.deregister();\n  }, [controls]);\n\n  camera.fov = fov;\n  camera.up = new Vector3(0, -1, 0);\n  camera.position.set(0, 0, 0);\n  camera.lookAt(0, 0, 100);\n  camera.updateProjectionMatrix();\n\n  let pose;\n  if (initialPose) {\n    pose = initialPose;\n  } else if (model.position.z === 0) {\n    pose = {\n      position: CONFIG.default_pose.position.slice(),\n      rotation: CONFIG.default_pose.rotation.slice(),\n    };\n  } else {\n    const { x, y, z, w } = model.quaternion;\n    pose = {\n      position: model.position.toArray(),\n      rotation: [w, x, y, z],\n    };\n  }\n  const [w, x, y, z] = pose.rotation;\n  model.position.set(...pose.position);\n  model.setRotationFromQuaternion(new Quaternion(x, y, z, w));\n  setPose(pose, pose === initialPose);\n\n  const composer = React.useRef();\n  useFrame((state, delta) => {\n    controls.update(delta);\n    composer.current.render();\n  }, 1);\n\n  return [\n    <primitive key=\"object\" object={model} />,\n    <effectComposer key=\"composer\" ref={composer} args={[gl]}>\n      <renderPass attachArray=\"passes\" scene={scene} camera={camera} />\n      <shaderPass attachArray=\"passes\" args={[OpacityShader(CONFIG.opacity)]} />\n    </effectComposer>,\n  ];\n}\n\nfunction Viewer({ model, fov, position, setPose, initialPose }) {\n  console.log(\"viewer re-render\");\n\n  return (\n    <Canvas style={{ position: \"absolute\", ...position }}>\n      <pointLight position={[0, 0, 0]} intensity={1} />\n      {model ? <Renderer {...{ model, fov, setPose, initialPose }} /> : null}\n    </Canvas>\n  );\n}\n\nexport default React.memo(Viewer);\n","/**\n * Full-screen textured quad shader\n */\n\nexport default function OpacityShader(opacity) {\n  return {\n    uniforms: {\n      tDiffuse: { value: null },\n      opacity: { value: opacity },\n    },\n\n    vertexShader: [\n      \"varying vec2 vUv;\",\n\n      \"void main() {\",\n\n      \"\tvUv = uv;\",\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\n      \"}\",\n    ].join(\"\\n\"),\n\n    fragmentShader: [\n      \"uniform float opacity;\",\n\n      \"uniform sampler2D tDiffuse;\",\n\n      \"varying vec2 vUv;\",\n\n      \"void main() {\",\n\n      \"\tvec4 texel = texture2D( tDiffuse, vUv );\",\n      \"\tgl_FragColor = opacity * texel;\",\n\n      \"}\",\n    ].join(\"\\n\"),\n  };\n}\n","import React from \"react\";\nimport { Button } from \"react-bootstrap\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\n\nfunction saveAs(obj) {\n  if (Object.keys(obj).length === 0) {\n    return;\n  }\n  const a = document.createElement(\"a\");\n  const file = new Blob([JSON.stringify(obj)], { type: \"text/plain\" });\n  a.href = URL.createObjectURL(file);\n  a.download = \"poses.json\";\n  a.click();\n  URL.revokeObjectURL(a.href);\n}\n\nfunction loadModel(loader, file, setModel, setError) {\n  file.arrayBuffer().then((ab) => {\n    try {\n      loader.parse(ab, \"\", (gltf) => {\n        setModel(gltf.scenes[0].children[0]);\n        setError(null);\n      });\n    } catch {\n      setError(\"Error loading model. Please try again.\");\n    }\n  });\n}\n\nfunction loadIntrinsics(\n  file,\n  setIntrinsics,\n  setError,\n  setIntrinsicsName,\n  images\n) {\n  file.text().then((resultText) => {\n    let intrinsics;\n    try {\n      intrinsics = JSON.parse(resultText);\n    } catch {\n      setError(\"Error parsing intrinsics file. Please try again.\");\n      return;\n    }\n    const keys = new Set(Object.keys(intrinsics));\n    if (!Array.from(images).every((i) => keys.has(i.name))) {\n      setError(\"Missing entry in intrinsics file for image.\");\n      return;\n    }\n    if (!Object.values(intrinsics).every((i) => typeof i.fov_y === \"number\")) {\n      setError(\"Intrinsics file has incorrect format.\");\n      return;\n    }\n    setIntrinsics(intrinsics);\n    setIntrinsicsName(file.name);\n    setError(null);\n  });\n}\n\nfunction loadPoses(file, setPoses, setError, images) {\n  file.text().then((resultText) => {\n    let poses;\n    try {\n      poses = JSON.parse(resultText);\n    } catch {\n      setError(\"Error parsing poses file. Please try again.\");\n    }\n    const keys = new Set(Object.keys(poses));\n    if (!Array.from(images).every((i) => keys.has(i.name))) {\n      setError(\"Missing entry in poses file for image.\");\n      return;\n    }\n    if (\n      !Object.values(poses).every(\n        (p) =>\n          Array.isArray(p.position) &&\n          Array.isArray(p.rotation) &&\n          p.position.length === 3 &&\n          p.rotation.length === 4 &&\n          p.position.concat(p.rotation).every((e) => typeof e === \"number\")\n      )\n    ) {\n      setError(\"Poses file has incorrect format.\");\n      return;\n    }\n    setPoses(poses);\n    setError(null);\n  });\n}\n\nfunction OpenFileButton(props) {\n  const ref = React.useRef();\n  const { children, label, disabled, onChoose, ...others } = props;\n  return [\n    <input\n      key=\"input\"\n      type=\"file\"\n      ref={ref}\n      style={{ display: \"none\" }}\n      onChange={(event) => {\n        onChoose([...event.target.files]);\n        ref.current.value = \"\";\n      }}\n      {...others}\n    />,\n    <div key=\"button\" className=\"OpenFileButton\">\n      <div className=\"OpenFileButton-label\">{label}</div>\n      <Button\n        size=\"sm\"\n        variant=\"light\"\n        disabled={disabled === undefined ? false : disabled}\n        onClick={() => ref.current.click()}\n      >\n        {children}\n      </Button>\n    </div>,\n  ];\n}\n\nexport default function TopBar({\n  setCurrentImageIndex,\n  images,\n  fov,\n  setImages,\n  model,\n  setModel,\n  setIntrinsics,\n  currentPose,\n  setPoses,\n  poses,\n  isPoseSaved,\n}) {\n  const [intrinsicsName, setIntrinsicsName] = React.useState(\"\");\n  const [modelName, setModelName] = React.useState(\"\");\n  const [error, setError] = React.useState(null);\n  const loader = React.useMemo(() => new GLTFLoader(), []);\n\n  return (\n    <div className=\"StatusBar\">\n      {currentPose && currentPose.position && currentPose.rotation && !error ? (\n        <div className={`pose ${isPoseSaved ? \"saved\" : \"\"}`}>\n          <div>{`position: (${currentPose.position.map((n) =>\n            n.toFixed(2)\n          )})`}</div>\n          <div>{`rotation: (${currentPose.rotation.map((n) =>\n            n.toFixed(2)\n          )})`}</div>\n        </div>\n      ) : null}\n      {error ? <div className=\"error\">{error}</div> : null}\n      <div>\n        {fov ? `fov: (${fov.x.toFixed(2)}, ${fov.y.toFixed(2)})` : null}\n      </div>\n      <div>\n        <OpenFileButton\n          label={images.length ? `${images.length} images ` : null}\n          multiple\n          accept=\"image/*\"\n          onChoose={(files) => {\n            if (files.length > 0) {\n              setCurrentImageIndex(0);\n              setImages(files);\n              setIntrinsics(undefined);\n              setPoses([]);\n              setError(null);\n            }\n          }}\n        >\n          Load images\n        </OpenFileButton>\n      </div>\n      <div>\n        <OpenFileButton\n          label={modelName}\n          accept=\".glb\"\n          onChoose={(files) => {\n            if (files.length > 0) {\n              setModelName(files[0].name);\n              loadModel(loader, files[0], setModel, setError);\n            }\n          }}\n        >\n          Load model\n        </OpenFileButton>\n      </div>\n      <div>\n        <OpenFileButton\n          label={intrinsicsName}\n          accept=\".json\"\n          disabled={!(model && images)}\n          onChoose={(files) => {\n            if (files.length > 0) {\n              loadIntrinsics(\n                files[0],\n                setIntrinsics,\n                setError,\n                setIntrinsicsName,\n                images\n              );\n            }\n          }}\n        >\n          Load intrinsics\n        </OpenFileButton>\n      </div>\n      <div>\n        <OpenFileButton\n          accept=\".json\"\n          disabled={!(model && images)}\n          onChoose={(files) => {\n            if (files.length > 0) {\n              loadPoses(files[0], setPoses, setError, images);\n            }\n          }}\n        >\n          Load poses\n        </OpenFileButton>\n      </div>\n      <div>\n        <Button\n          size=\"sm\"\n          variant=\"light\"\n          disabled={Object.keys(poses).length === 0}\n          onClick={() => saveAs(poses)}\n        >\n          Download poses\n        </Button>\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { ListGroup } from \"react-bootstrap\";\n\nfunction Sidebar({ images, currentImageIndex, setCurrentImageIndex }) {\n  return (\n    <ListGroup variant=\"flush\" className=\"SideBar\">\n      {Array.from(images).map((image, i) => (\n        <ListGroup.Item\n          active={currentImageIndex === i}\n          key={i}\n          onClick={() => setCurrentImageIndex(i)}\n        >\n          {image.name}\n        </ListGroup.Item>\n      ))}\n    </ListGroup>\n  );\n}\n\nexport default React.memo(Sidebar);\n","import image_000 from \"./image_000.png\";\nimport image_240 from \"./image_240.png\";\nimport image_480 from \"./image_480.png\";\nimport cygnus from \"./cygnus.glb\";\nimport intrinsics from \"./intrinsics.json\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nconst IMAGE_NAMES = [\"image_000.png\", \"image_240.png\", \"image_480.png\"];\n\nexport default function loadSampleData(setImages, setIntrinsics, setModel) {\n  const imagesPromise = Promise.all(\n    [image_000, image_240, image_480].map((image, i) =>\n      window\n        .fetch(image)\n        .then((res) => res.blob())\n        .then((blob) => {\n          blob.name = IMAGE_NAMES[i];\n          return blob;\n        })\n    )\n  );\n  const loader = new GLTFLoader();\n  const modelPromise = window\n    .fetch(cygnus)\n    .then((res) => res.arrayBuffer())\n    .then(\n      (ab) =>\n        new Promise((resolve) =>\n          loader.parse(ab, \"\", (gltf) => resolve(gltf.scenes[0].children[0]))\n        )\n    );\n\n  Promise.all([imagesPromise, modelPromise]).then(([images, model]) => {\n    setImages(images);\n    setModel(model);\n    setIntrinsics(intrinsics);\n  });\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport Viewer from \"./viewer\";\nimport TopBar from \"./topbar\";\nimport Sidebar from \"./sidebar\";\nimport loadSampleData from \"./sample_data/load_sample_data\";\n\nfunction computeViewerPosition(img) {\n  const { naturalHeight, naturalWidth, height, width } = img;\n  const rescale = Math.min(height / naturalHeight, width / naturalWidth);\n  const [newHeight, newWidth] = [\n    naturalHeight * rescale,\n    naturalWidth * rescale,\n  ];\n  return {\n    height: newHeight,\n    width: newWidth,\n    left: (width - newWidth) / 2,\n    top: (height - newHeight) / 2,\n  };\n}\n\nfunction App() {\n  console.log(\"index re-render\");\n\n  const [images, setImages] = React.useState([]);\n  const [intrinsics, setIntrinsics] = React.useState();\n  const [model, setModel] = React.useState();\n  const [viewerPosition, setViewerPosition] = React.useState();\n  const [poses, setPoses] = React.useState({});\n  const [currentPose, setCurrentPose] = React.useState();\n  const [currentImageIndex, setCurrentImageIndex] = React.useState(0);\n  const [isPoseSaved, setIsPoseSaved] = React.useState(false);\n\n  React.useEffect(() => loadSampleData(setImages, setIntrinsics, setModel), []);\n\n  const imgRef = React.useRef();\n  const imgUrlRef = React.useRef();\n  const imgUrl = React.useMemo(() => {\n    if (imgUrlRef.current) URL.revokeObjectURL(imgUrlRef.current);\n    imgUrlRef.current =\n      images.length > 0\n        ? URL.createObjectURL(images[currentImageIndex])\n        : undefined;\n    return imgUrlRef.current;\n  }, [images, currentImageIndex]);\n\n  const handleKeyDown = React.useCallback(\n    (event) => {\n      if (images.length === 0 || event.repeat) return;\n      if (event.code === \"PageDown\") {\n        event.preventDefault();\n        setCurrentImageIndex((currentImageIndex + 1) % images.length);\n      }\n      if (event.code === \"PageUp\") {\n        event.preventDefault();\n        setCurrentImageIndex(\n          (currentImageIndex - 1 + images.length) % images.length // Javascript is a cruel joke\n        );\n      }\n    },\n    [images, currentImageIndex]\n  );\n  React.useEffect(() => {\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [handleKeyDown]);\n\n  const handleResize = React.useCallback(() => {\n    if (imgRef.current)\n      setViewerPosition(computeViewerPosition(imgRef.current));\n  }, []);\n  React.useEffect(() => {\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, [handleResize]);\n\n  const setPose = React.useCallback(\n    (pose, save) => {\n      // cause the topbar to re-render\n      setCurrentPose(pose);\n\n      if (images.length === 0) return;\n      if (!save) {\n        setIsPoseSaved(false);\n        return;\n      }\n\n      if (poses[images[currentImageIndex].name]) {\n        // copy into the same reference so that the viewer doesn't re-render\n        Object.assign(poses[images[currentImageIndex].name], pose);\n      } else {\n        poses[images[currentImageIndex].name] = pose;\n      }\n      setIsPoseSaved(true);\n    },\n    [poses, images, currentImageIndex]\n  );\n\n  const fov =\n    intrinsics && images.length > 0\n      ? intrinsics[images[currentImageIndex].name].fov_y\n      : 40;\n\n  return (\n    <div className=\"main-wrapper\">\n      <TopBar\n        {...{\n          fov: viewerPosition\n            ? {\n                y: fov,\n                x: (fov * viewerPosition.width) / viewerPosition.height,\n              }\n            : undefined,\n          setCurrentImageIndex,\n          images,\n          setImages,\n          model,\n          setModel,\n          setIntrinsics,\n          currentPose,\n          setPoses,\n          poses,\n          isPoseSaved,\n        }}\n      />\n      <div className=\"body-wrapper\">\n        <div className=\"Viewer-wrapper\">\n          {imgUrl ? (\n            <img\n              className=\"background-image\"\n              alt=\"\"\n              key=\"img\"\n              ref={imgRef}\n              src={imgUrl}\n              onLoad={() => {\n                setViewerPosition(computeViewerPosition(imgRef.current));\n              }}\n            />\n          ) : (\n            <div className=\"loading\">Loading sample data...</div>\n          )}\n          <Viewer\n            key=\"viewer\"\n            {...{\n              fov,\n              model,\n              position: viewerPosition,\n              initialPose:\n                images.length > 0\n                  ? poses[images[currentImageIndex].name]\n                  : undefined,\n              setPose,\n            }}\n          />\n        </div>\n        <Sidebar\n          {...{\n            images,\n            currentImageIndex,\n            setCurrentImageIndex,\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}