{"version":3,"sources":["sample_data/image_000.png","sample_data/image_240.png","sample_data/image_480.png","sample_data/cygnus.glb","utils.js","controls.js","viewer.js","OpacityShader.js","topbar.js","sidebar.js","sample_data/load_sample_data.js","settings_modal.js","config.js","index.js"],"names":["module","exports","ROTATE_FORWARD","Quaternion","setFromRotationMatrix","Matrix4","makeRotationX","Math","PI","ROTATE_BACKWARD","encodeRotation","quaternion","clone","multiply","x","y","z","w","Controls","model","setPose","config","this","actions","Object","fromEntries","entries","keybindings","map","action","bind","keyDownListener","handleKeyDown","keyUpListener","handleKeyUp","executingActions","Set","translate_speed","rotate_speed","document","addEventListener","removeEventListener","event","repeat","code","undefined","_decreaseSpeed","preventDefault","add","_resetSpeed","_recordPose","delete","delta","save","position","toArray","rotation","translate_speed_low","rotate_speed_low","rotateOnAxis","Vector3","Renderer","fov","initialPose","console","log","pose","useThree","camera","gl","scene","controls","React","useMemo","useLayoutEffect","register","deregister","up","set","lookAt","far","updateProjectionMatrix","default_pose","slice","setRotationFromQuaternion","quatArray","decodeRotation","opacity","composer","useRef","useFrame","state","update","current","render","key","object","ref","args","attachArray","uniforms","tDiffuse","value","vertexShader","join","fragmentShader","extend","ShaderPass","RenderPass","EffectComposer","memo","style","intensity","OpenFileButton","props","children","label","disabled","onChoose","others","type","display","onChange","target","files","className","Button","size","variant","onClick","click","TopBar","setCurrentImageIndex","currentImageIndex","images","setImages","setModel","setIntrinsics","currentPose","setPoses","poses","useState","intrinsicsName","setIntrinsicsName","modelName","setModelName","error","setError","loader","GLTFLoader","Euler","setFromQuaternion","isPoseSaved","equal","name","n","toFixed","length","multiple","accept","file","arrayBuffer","then","ab","parse","gltf","scenes","loadModel","text","resultText","intrinsics","JSON","keys","Array","from","every","i","has","values","fov_y","loadIntrinsics","p","isArray","concat","e","loadPoses","obj","a","createElement","Blob","stringify","href","URL","createObjectURL","download","revokeObjectURL","saveAs","ListGroup","image","Item","active","IMAGE_NAMES","CONFIGURABLE_KEYS","Row","subConfig","setSubConfig","configKey","step","min","defaultValue","parseFloat","SettingsModal","isSettingsShown","setIsSettingsShown","setConfig","Modal","show","onHide","Header","closeButton","Title","Body","Footer","CONFIG","translateUp","translateDown","translateLeft","translateRight","translateForward","translateBackward","rotateMinusZ","rotatePlusZ","rotateMinusY","rotatePlusY","rotateMinusX","rotatePlusX","decreaseSpeed","savePose","computeViewerPosition","img","naturalHeight","naturalWidth","height","width","rescale","newHeight","newWidth","left","top","App","viewerPosition","setViewerPosition","setCurrentPose","useEffect","imagesPromise","Promise","all","image_000","image_240","image_480","window","fetch","res","blob","modelPromise","cygnus","resolve","loadSampleData","imgRef","imgUrlRef","imgUrl","useCallback","newImageIndex","handleResize","assign","alt","src","onLoad","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.8c916e49.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/image_000.1d777ccf.png\";","module.exports = __webpack_public_path__ + \"static/media/image_240.097c432e.png\";","module.exports = __webpack_public_path__ + \"static/media/image_480.90688ae9.png\";","module.exports = __webpack_public_path__ + \"static/media/cygnus.7bb66b61.glb\";","import { Quaternion, Matrix4 } from \"three\";\n\nconst ROTATE_FORWARD = new Quaternion().setFromRotationMatrix(\n  new Matrix4().makeRotationX(Math.PI / 2)\n);\nconst ROTATE_BACKWARD = new Quaternion().setFromRotationMatrix(\n  new Matrix4().makeRotationX(-Math.PI / 2)\n);\n\nexport function encodeRotation(quaternion) {\n  const { x, y, z, w } = quaternion.clone().multiply(ROTATE_BACKWARD);\n  return [w, x, y, z];\n}\n\nexport function decodeRotation(quatArray) {\n  const [w, x, y, z] = quatArray;\n  return new Quaternion(x, y, z, w).multiply(ROTATE_FORWARD);\n}\n","import { Vector3 } from \"three\";\nimport { encodeRotation } from \"./utils\";\n\nexport default class Controls {\n  constructor(model, setPose, config) {\n    this.config = config;\n    this.actions = Object.fromEntries(\n      Object.entries(config.keybindings).map(([action, keycode]) => [\n        keycode,\n        this[action] ? this[action].bind(this) : action,\n      ])\n    );\n    this.model = model;\n    this.keyDownListener = this.handleKeyDown.bind(this);\n    this.keyUpListener = this.handleKeyUp.bind(this);\n    this.executingActions = new Set();\n    this.translate_speed = config.translate_speed;\n    this.rotate_speed = (config.rotate_speed * 2 * Math.PI) / 180;\n    this.setPose = setPose;\n  }\n\n  register() {\n    document.addEventListener(\"keydown\", this.keyDownListener);\n    document.addEventListener(\"keyup\", this.keyUpListener);\n  }\n\n  deregister() {\n    document.removeEventListener(\"keydown\", this.keyDownListener);\n    document.removeEventListener(\"keyup\", this.keyUpListener);\n  }\n\n  handleKeyDown(event) {\n    // if (this.actions[event.code]) event.preventDefault();\n    if (event.repeat) return;\n    switch (this.actions[event.code]) {\n      case undefined:\n        break;\n      case \"decreaseSpeed\":\n        this._decreaseSpeed();\n        break;\n      case \"savePose\":\n        event.preventDefault();\n        break;\n      default:\n        this.executingActions.add(this.actions[event.code]);\n    }\n  }\n\n  handleKeyUp(event) {\n    // if (this.actions[event.code]) event.preventDefault();\n    switch (this.actions[event.code]) {\n      case undefined:\n        break;\n      case \"decreaseSpeed\":\n        this._resetSpeed();\n        break;\n      case \"savePose\":\n        event.preventDefault();\n        this._recordPose(true);\n        break;\n      default:\n        this.executingActions.delete(this.actions[event.code]);\n        this._recordPose(false);\n    }\n  }\n\n  update(delta) {\n    for (const action of this.executingActions) {\n      action(delta);\n    }\n  }\n\n  _recordPose(save) {\n    this.setPose(\n      {\n        position: this.model.position.toArray(),\n        rotation: encodeRotation(this.model.quaternion),\n      },\n      save\n    );\n  }\n\n  _decreaseSpeed() {\n    this.translate_speed = this.config.translate_speed_low;\n    this.rotate_speed = (this.config.rotate_speed_low * 2 * Math.PI) / 180;\n  }\n  _resetSpeed() {\n    this.translate_speed = this.config.translate_speed;\n    this.rotate_speed = (this.config.rotate_speed * 2 * Math.PI) / 180;\n  }\n\n  translateUp(delta) {\n    this.model.position.y -= this.translate_speed * delta;\n  }\n  translateDown(delta) {\n    this.model.position.y += this.translate_speed * delta;\n  }\n  translateLeft(delta) {\n    this.model.position.x -= this.translate_speed * delta;\n  }\n  translateRight(delta) {\n    this.model.position.x += this.translate_speed * delta;\n  }\n  translateForward(delta) {\n    this.model.position.z += this.translate_speed * delta;\n  }\n  translateBackward(delta) {\n    this.model.position.z -= this.translate_speed * delta;\n  }\n  rotatePlusZ(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 0, 1), this.rotate_speed * delta);\n  }\n  rotateMinusZ(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 0, 1), -this.rotate_speed * delta);\n  }\n  rotatePlusY(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 1, 0), this.rotate_speed * delta);\n  }\n  rotateMinusY(delta) {\n    this.model.rotateOnAxis(new Vector3(0, 1, 0), -this.rotate_speed * delta);\n  }\n  rotatePlusX(delta) {\n    this.model.rotateOnAxis(new Vector3(1, 0, 0), this.rotate_speed * delta);\n  }\n  rotateMinusX(delta) {\n    this.model.rotateOnAxis(new Vector3(1, 0, 0), -this.rotate_speed * delta);\n  }\n}\n","import React from \"react\";\nimport { extend } from \"react-three-fiber\";\nimport { Canvas, useFrame, useThree } from \"react-three-fiber\";\nimport { Vector3 } from \"three\";\nimport { encodeRotation, decodeRotation } from \"./utils\";\nimport { ShaderPass } from \"three/examples/jsm/postprocessing/ShaderPass\";\nimport { RenderPass } from \"three/examples/jsm/postprocessing/RenderPass\";\nimport { EffectComposer } from \"three/examples/jsm/postprocessing/EffectComposer\";\nimport Controls from \"./controls\";\nimport OpacityShader from \"./OpacityShader\";\nextend({ ShaderPass, RenderPass, EffectComposer });\n\nfunction Renderer({ model, fov, setPose, initialPose, config }) {\n  console.log(\"renderer re-render\");\n  const { camera, gl, scene } = useThree();\n\n  const controls = React.useMemo(() => new Controls(model, setPose, config), [\n    model,\n    setPose,\n    config,\n  ]);\n  // Need useLayoutEffect because we want the controls to deregister ASAP (before render) whenever\n  // the image changes. With regular useEffect, which happens after render, there is a brief window of time\n  // between when the model's pose gets updated for the new image and when the old controls get de-registered.\n  // Since the old controls have the old setPose, they can set the new image's pose on the old image during this window.\n  React.useLayoutEffect(() => {\n    controls.register();\n    return () => controls.deregister();\n  }, [controls]);\n\n  camera.fov = fov;\n  camera.up = new Vector3(0, -1, 0);\n  camera.position.set(0, 0, 0);\n  camera.lookAt(0, 0, 100);\n  camera.far = 100000;\n  camera.updateProjectionMatrix();\n\n  let pose;\n  if (initialPose) {\n    pose = initialPose;\n  } else if (model.position.z === 0) {\n    pose = {\n      position: config.default_pose.position.slice(),\n      rotation: config.default_pose.rotation.slice(),\n    };\n  } else {\n    pose = {\n      position: model.position.toArray(),\n      rotation: encodeRotation(model.quaternion),\n    };\n  }\n  model.position.set(...pose.position);\n  model.setRotationFromQuaternion(decodeRotation(pose.rotation));\n  setPose(pose, false);\n\n  const composer = React.useRef();\n  useFrame((state, delta) => {\n    controls.update(delta);\n    composer.current.render();\n  }, 1);\n\n  return [\n    <primitive key=\"object\" object={model} />,\n    <effectComposer key=\"composer\" ref={composer} args={[gl]}>\n      <renderPass attachArray=\"passes\" scene={scene} camera={camera} />\n      <shaderPass attachArray=\"passes\" args={[OpacityShader(config.opacity)]} />\n    </effectComposer>,\n  ];\n}\n\nfunction Viewer({ model, fov, position, setPose, initialPose, config }) {\n  console.log(\"viewer re-render\");\n\n  return (\n    <Canvas style={{ position: \"absolute\", ...position }}>\n      <pointLight position={[0, 0, 0]} intensity={1} />\n      {model ? (\n        <Renderer {...{ model, fov, setPose, initialPose, config }} />\n      ) : null}\n    </Canvas>\n  );\n}\n\nexport default React.memo(Viewer);\n","/**\n * Full-screen textured quad shader\n */\n\nexport default function OpacityShader(opacity) {\n  return {\n    uniforms: {\n      tDiffuse: { value: null },\n      opacity: { value: opacity },\n    },\n\n    vertexShader: [\n      \"varying vec2 vUv;\",\n\n      \"void main() {\",\n\n      \"\tvUv = uv;\",\n      \"\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\n      \"}\",\n    ].join(\"\\n\"),\n\n    fragmentShader: [\n      \"uniform float opacity;\",\n\n      \"uniform sampler2D tDiffuse;\",\n\n      \"varying vec2 vUv;\",\n\n      \"void main() {\",\n\n      \"\tvec4 texel = texture2D( tDiffuse, vUv );\",\n      \"\tgl_FragColor = opacity * texel;\",\n\n      \"}\",\n    ].join(\"\\n\"),\n  };\n}\n","import React from \"react\";\nimport { Button } from \"react-bootstrap\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport { Euler, Quaternion } from \"three\";\nimport * as equal from \"fast-deep-equal\";\n\nfunction saveAs(obj) {\n  if (Object.keys(obj).length === 0) {\n    return;\n  }\n  const a = document.createElement(\"a\");\n  const file = new Blob([JSON.stringify(obj)], { type: \"text/plain\" });\n  a.href = URL.createObjectURL(file);\n  a.download = \"poses.json\";\n  a.click();\n  URL.revokeObjectURL(a.href);\n}\n\nfunction loadModel(loader, file, setModel, setError) {\n  file.arrayBuffer().then((ab) => {\n    try {\n      loader.parse(ab, \"\", (gltf) => {\n        setModel(gltf.scenes[0].children[0]);\n        setError(null);\n      });\n    } catch {\n      setError(\"Error loading model. Please try again.\");\n    }\n  });\n}\n\nfunction loadIntrinsics(\n  file,\n  setIntrinsics,\n  setError,\n  setIntrinsicsName,\n  images\n) {\n  file.text().then((resultText) => {\n    let intrinsics;\n    try {\n      intrinsics = JSON.parse(resultText);\n    } catch {\n      setError(\"Error parsing intrinsics file. Please try again.\");\n      return;\n    }\n    const keys = new Set(Object.keys(intrinsics));\n    if (!Array.from(images).every((i) => keys.has(i.name))) {\n      setError(\"Missing entry in intrinsics file for image.\");\n      return;\n    }\n    if (!Object.values(intrinsics).every((i) => typeof i.fov_y === \"number\")) {\n      setError(\"Intrinsics file has incorrect format.\");\n      return;\n    }\n    setIntrinsics(intrinsics);\n    setIntrinsicsName(file.name);\n    setError(null);\n  });\n}\n\nfunction loadPoses(file, setPoses, setError, images) {\n  file.text().then((resultText) => {\n    let poses;\n    try {\n      poses = JSON.parse(resultText);\n    } catch {\n      setError(\"Error parsing poses file. Please try again.\");\n    }\n    if (\n      !Object.values(poses).every(\n        (p) =>\n          Array.isArray(p.position) &&\n          Array.isArray(p.rotation) &&\n          p.position.length === 3 &&\n          p.rotation.length === 4 &&\n          p.position.concat(p.rotation).every((e) => typeof e === \"number\")\n      )\n    ) {\n      setError(\"Poses file has incorrect format.\");\n      return;\n    }\n    setPoses(poses);\n    setError(null);\n  });\n}\n\nfunction OpenFileButton(props) {\n  const ref = React.useRef();\n  const { children, label, disabled, onChoose, ...others } = props;\n  return [\n    <input\n      key=\"input\"\n      type=\"file\"\n      ref={ref}\n      style={{ display: \"none\" }}\n      onChange={(event) => {\n        onChoose([...event.target.files]);\n        ref.current.value = \"\";\n      }}\n      {...others}\n    />,\n    <div key=\"button\" className=\"OpenFileButton\">\n      <div className=\"OpenFileButton-label\">{label}</div>\n      <Button\n        size=\"sm\"\n        variant=\"light\"\n        disabled={disabled === undefined ? false : disabled}\n        onClick={() => ref.current.click()}\n      >\n        {children}\n      </Button>\n    </div>,\n  ];\n}\n\nexport default function TopBar({\n  setCurrentImageIndex,\n  currentImageIndex,\n  images,\n  fov,\n  setImages,\n  model,\n  setModel,\n  setIntrinsics,\n  currentPose,\n  setPoses,\n  poses,\n}) {\n  const [intrinsicsName, setIntrinsicsName] = React.useState(\"\");\n  const [modelName, setModelName] = React.useState(\"\");\n  const [error, setError] = React.useState(null);\n  const loader = React.useMemo(() => new GLTFLoader(), []);\n\n  const rotation = React.useMemo(() => {\n    if (currentPose && currentPose.rotation) {\n      const [w, x, y, z] = currentPose.rotation;\n      const { x: ex, y: ey, z: ez } = new Euler().setFromQuaternion(\n        new Quaternion(x, y, z, w),\n        \"ZYX\"\n      );\n      return [ex, ey, ez];\n    } else {\n      return undefined;\n    }\n  }, [currentPose]);\n\n  const isPoseSaved = React.useMemo(\n    () =>\n      currentPose && currentPose.position && rotation\n        ? equal(currentPose, poses[images[currentImageIndex].name])\n        : false,\n    [poses, currentPose, currentImageIndex, images, rotation]\n  );\n\n  return (\n    <div className=\"StatusBar\">\n      {currentPose && currentPose.position && rotation && !error ? (\n        <div className={`pose ${isPoseSaved ? \"saved\" : \"\"}`}>\n          <div>{`position: (${currentPose.position.map((n) =>\n            n.toFixed(2)\n          )})`}</div>\n          <div>{`rotation: (${rotation.map((n) =>\n            ((n * 180) / Math.PI).toFixed(2)\n          )})`}</div>\n        </div>\n      ) : null}\n      {error ? <div className=\"error\">{error}</div> : null}\n      <div>\n        {fov ? `fov: (${fov.x.toFixed(2)}, ${fov.y.toFixed(2)})` : null}\n      </div>\n      <div>\n        <OpenFileButton\n          label={images.length ? `${images.length} images ` : null}\n          multiple\n          accept=\"image/*\"\n          onChoose={(files) => {\n            if (files.length > 0) {\n              setCurrentImageIndex(0);\n              setImages(files);\n              setIntrinsics(undefined);\n              setPoses({});\n              setError(null);\n            }\n          }}\n        >\n          Load images\n        </OpenFileButton>\n      </div>\n      <div>\n        <OpenFileButton\n          label={modelName}\n          accept=\".glb\"\n          onChoose={(files) => {\n            if (files.length > 0) {\n              setModelName(files[0].name);\n              loadModel(loader, files[0], setModel, setError);\n            }\n          }}\n        >\n          Load model\n        </OpenFileButton>\n      </div>\n      <div>\n        <OpenFileButton\n          label={intrinsicsName}\n          accept=\".json\"\n          disabled={!(model && images)}\n          onChoose={(files) => {\n            if (files.length > 0) {\n              loadIntrinsics(\n                files[0],\n                setIntrinsics,\n                setError,\n                setIntrinsicsName,\n                images\n              );\n            }\n          }}\n        >\n          Load intrinsics\n        </OpenFileButton>\n      </div>\n      <div>\n        <OpenFileButton\n          accept=\".json\"\n          disabled={!(model && images)}\n          onChoose={(files) => {\n            if (files.length > 0) {\n              loadPoses(files[0], setPoses, setError, images);\n            }\n          }}\n        >\n          Load poses\n        </OpenFileButton>\n      </div>\n      <div>\n        <Button\n          size=\"sm\"\n          variant=\"light\"\n          disabled={Object.keys(poses).length === 0}\n          onClick={() => saveAs(poses)}\n        >\n          Download poses\n        </Button>\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport { ListGroup } from \"react-bootstrap\";\n\nfunction Sidebar({ images, currentImageIndex, setCurrentImageIndex }) {\n  return (\n    <ListGroup variant=\"flush\" className=\"SideBar\">\n      {Array.from(images).map((image, i) => (\n        <ListGroup.Item\n          active={currentImageIndex === i}\n          key={i}\n          onClick={() => setCurrentImageIndex(i)}\n        >\n          {image.name}\n        </ListGroup.Item>\n      ))}\n    </ListGroup>\n  );\n}\n\nexport default React.memo(Sidebar);\n","import image_000 from \"./image_000.png\";\nimport image_240 from \"./image_240.png\";\nimport image_480 from \"./image_480.png\";\nimport cygnus from \"./cygnus.glb\";\nimport intrinsics from \"./intrinsics.json\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nconst IMAGE_NAMES = [\"image_000.png\", \"image_240.png\", \"image_480.png\"];\n\nexport default function loadSampleData(setImages, setIntrinsics, setModel) {\n  const imagesPromise = Promise.all(\n    [image_000, image_240, image_480].map((image, i) =>\n      window\n        .fetch(image)\n        .then((res) => res.blob())\n        .then((blob) => {\n          blob.name = IMAGE_NAMES[i];\n          return blob;\n        })\n    )\n  );\n  const loader = new GLTFLoader();\n  const modelPromise = window\n    .fetch(cygnus)\n    .then((res) => res.arrayBuffer())\n    .then(\n      (ab) =>\n        new Promise((resolve) =>\n          loader.parse(ab, \"\", (gltf) => resolve(gltf.scenes[0].children[0]))\n        )\n    );\n\n  Promise.all([imagesPromise, modelPromise]).then(([images, model]) => {\n    setImages(images);\n    setModel(model);\n    setIntrinsics(intrinsics);\n  });\n}\n","import { Modal, Button, ListGroup } from \"react-bootstrap\";\nimport React from \"react\";\n\nconst CONFIGURABLE_KEYS = [\n  \"opacity\",\n  \"translate_speed\",\n  \"translate_speed_low\",\n  \"rotate_speed\",\n  \"rotate_speed_low\",\n];\n\nfunction Row({ subConfig, setSubConfig, configKey }) {\n  const ref = React.useRef();\n  return (\n    <ListGroup.Item>\n      {configKey}:{\" \"}\n      <input\n        type=\"number\"\n        step={0.01}\n        min={0}\n        defaultValue={subConfig[configKey]}\n        ref={ref}\n        onChange={() =>\n          setSubConfig({\n            ...subConfig,\n            [configKey]: parseFloat(ref.current.value),\n          })\n        }\n      />\n    </ListGroup.Item>\n  );\n}\n\nexport default function SettingsModal({\n  isSettingsShown,\n  setIsSettingsShown,\n  config,\n  setConfig,\n}) {\n  const [subConfig, setSubConfig] = React.useState(\n    Object.fromEntries(CONFIGURABLE_KEYS.map((key) => [key, config[key]]))\n  );\n  return (\n    <Modal show={isSettingsShown} onHide={() => setIsSettingsShown(false)}>\n      <Modal.Header closeButton>\n        <Modal.Title>Settings</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        <ListGroup>\n          {CONFIGURABLE_KEYS.map((key) => (\n            <Row {...{ subConfig, setSubConfig, configKey: key, key }} />\n          ))}\n        </ListGroup>\n      </Modal.Body>\n      <Modal.Footer>\n        <Button\n          variant=\"primary\"\n          onClick={() => {\n            setConfig({ ...config, ...subConfig });\n            setIsSettingsShown(false);\n          }}\n        >\n          Save Changes\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n","const CONFIG = {\n  keybindings: {\n    translateUp: \"KeyW\",\n    translateDown: \"KeyS\",\n    translateLeft: \"KeyA\",\n    translateRight: \"KeyD\",\n    translateForward: \"KeyZ\",\n    translateBackward: \"KeyX\",\n    rotateMinusZ: \"ArrowDown\",\n    rotatePlusZ: \"ArrowUp\",\n    rotateMinusY: \"ArrowLeft\",\n    rotatePlusY: \"ArrowRight\",\n    rotateMinusX: \"Slash\",\n    rotatePlusX: \"Period\",\n    decreaseSpeed: \"ShiftLeft\",\n    savePose: \"Enter\",\n  },\n  opacity: 0.7,\n  // meters/second\n  translate_speed: 5,\n  translate_speed_low: 0.5,\n  // degrees/second\n  rotate_speed: 20,\n  rotate_speed_low: 2,\n  default_pose: {\n    position: [0, 0, 50],\n    rotation: [1, 0, 0, 0],\n  },\n};\n\nexport default CONFIG;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport Viewer from \"./viewer\";\nimport TopBar from \"./topbar\";\nimport Sidebar from \"./sidebar\";\nimport loadSampleData from \"./sample_data/load_sample_data\";\nimport SettingsModal from \"./settings_modal\";\nimport CONFIG from \"./config\";\nimport { Gear } from \"react-bootstrap-icons\";\n\nfunction computeViewerPosition(img) {\n  const { naturalHeight, naturalWidth, height, width } = img;\n  const rescale = Math.min(height / naturalHeight, width / naturalWidth);\n  const [newHeight, newWidth] = [\n    naturalHeight * rescale,\n    naturalWidth * rescale,\n  ];\n  return {\n    height: newHeight,\n    width: newWidth,\n    left: (width - newWidth) / 2,\n    top: (height - newHeight) / 2,\n  };\n}\n\nfunction App() {\n  console.log(\"index re-render\");\n\n  const [images, setImages] = React.useState([]);\n  const [intrinsics, setIntrinsics] = React.useState();\n  const [model, setModel] = React.useState();\n  const [viewerPosition, setViewerPosition] = React.useState();\n  const [poses, setPoses] = React.useState({});\n  const [currentPose, setCurrentPose] = React.useState();\n  const [currentImageIndex, setCurrentImageIndex] = React.useState(0);\n  const [isSettingsShown, setIsSettingsShown] = React.useState(false);\n  const [config, setConfig] = React.useState(CONFIG);\n\n  React.useEffect(() => loadSampleData(setImages, setIntrinsics, setModel), []);\n\n  const imgRef = React.useRef();\n  const imgUrlRef = React.useRef();\n  const imgUrl = React.useMemo(() => {\n    if (imgUrlRef.current) URL.revokeObjectURL(imgUrlRef.current);\n    imgUrlRef.current =\n      images.length > 0\n        ? URL.createObjectURL(images[currentImageIndex])\n        : undefined;\n    return imgUrlRef.current;\n  }, [images, currentImageIndex]);\n\n  const handleKeyDown = React.useCallback(\n    (event) => {\n      if (\n        images.length === 0 ||\n        event.repeat ||\n        !(event.code === \"PageDown\" || event.code === \"PageUp\")\n      )\n        return;\n\n      event.preventDefault();\n      const newImageIndex =\n        event.code === \"PageDown\"\n          ? (currentImageIndex + 1) % images.length\n          : (currentImageIndex - 1 + images.length) % images.length; // Javascript is a cruel joke\n      setCurrentImageIndex(newImageIndex);\n    },\n    [images, currentImageIndex]\n  );\n  React.useEffect(() => {\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [handleKeyDown]);\n\n  const handleResize = React.useCallback(() => {\n    if (imgRef.current)\n      setViewerPosition(computeViewerPosition(imgRef.current));\n  }, []);\n  React.useEffect(() => {\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, [handleResize]);\n\n  const setPose = React.useCallback(\n    (pose, save) => {\n      // cause the topbar to re-render\n      setCurrentPose(pose);\n\n      if (images.length === 0) return;\n\n      if (save) {\n        if (poses[images[currentImageIndex].name]) {\n          // copy into the same reference so that the viewer doesn't re-render\n          Object.assign(poses[images[currentImageIndex].name], pose);\n        } else {\n          poses[images[currentImageIndex].name] = pose;\n        }\n        setCurrentImageIndex((currentImageIndex + 1) % images.length);\n      }\n    },\n    [poses, images, currentImageIndex]\n  );\n\n  const fov =\n    intrinsics && images.length > 0\n      ? intrinsics[images[currentImageIndex].name].fov_y\n      : 40;\n\n  return (\n    <div className=\"main-wrapper\">\n      <TopBar\n        {...{\n          fov: viewerPosition\n            ? {\n                y: fov,\n                x: (fov * viewerPosition.width) / viewerPosition.height,\n              }\n            : undefined,\n          setCurrentImageIndex,\n          images,\n          setImages,\n          model,\n          setModel,\n          setIntrinsics,\n          currentPose,\n          setPoses,\n          poses,\n          currentImageIndex,\n        }}\n      />\n      <div className=\"body-wrapper\">\n        <div className=\"Viewer-wrapper\">\n          {imgUrl ? (\n            <img\n              className=\"background-image\"\n              alt=\"\"\n              key=\"img\"\n              ref={imgRef}\n              src={imgUrl}\n              onLoad={() => {\n                setViewerPosition(computeViewerPosition(imgRef.current));\n              }}\n            />\n          ) : (\n            <div className=\"loading\">Loading sample data...</div>\n          )}\n          <Viewer\n            key=\"viewer\"\n            {...{\n              fov,\n              model,\n              position: viewerPosition,\n              initialPose:\n                images.length > 0\n                  ? poses[images[currentImageIndex].name]\n                  : undefined,\n              setPose,\n              config,\n            }}\n          />\n          <Gear\n            size={24}\n            className=\"settings-gear\"\n            onClick={() => setIsSettingsShown(true)}\n          />\n        </div>\n        <Sidebar\n          {...{\n            images,\n            currentImageIndex,\n            setCurrentImageIndex,\n          }}\n        />\n      </div>\n      <SettingsModal\n        {...{ isSettingsShown, setIsSettingsShown, config, setConfig }}\n      />\n    </div>\n  );\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}